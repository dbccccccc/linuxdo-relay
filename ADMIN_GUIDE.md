# ç®¡ç†åå°ä½¿ç”¨æŒ‡å—

## åŠŸèƒ½æ¦‚è§ˆ

LinuxDo-Relay ç®¡ç†åå°æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

### 1. ç”¨æˆ·ç®¡ç† (`/admin/users`)

**åŠŸèƒ½ï¼š**
- æŸ¥çœ‹æ‰€æœ‰æ³¨å†Œç”¨æˆ·åˆ—è¡¨
- ä¿®æ”¹ç”¨æˆ·è§’è‰²ï¼ˆæ™®é€šç”¨æˆ· / ç®¡ç†å‘˜ï¼‰
- è°ƒæ•´ç”¨æˆ·ç­‰çº§ï¼ˆå½±å“é…é¢è§„åˆ™ï¼‰
- å¯ç”¨/ç¦ç”¨ç”¨æˆ·è´¦æˆ·

**API æ¥å£ï¼š**
- `GET /admin/users` - è·å–ç”¨æˆ·åˆ—è¡¨
- `PUT /admin/users/:id` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
# è·å–ç”¨æˆ·åˆ—è¡¨
curl -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  http://localhost:8080/admin/users

# æ›´æ–°ç”¨æˆ·
curl -X PUT \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"role":"admin","level":2,"status":"normal"}' \
  http://localhost:8080/admin/users/1
```

**å­—æ®µè¯´æ˜ï¼š**
- `role`: `admin` æˆ– `user`
- `level`: æ•´æ•°ï¼Œæœ€å°ä¸º 1ï¼Œç”¨äºåŒ¹é…é…é¢è§„åˆ™
- `status`: `normal` æˆ– `disabled`ï¼ˆç¦ç”¨åç”¨æˆ·æ— æ³•ä½¿ç”¨ APIï¼‰

**æ³¨æ„äº‹é¡¹ï¼š**
- âš ï¸ ç”¨æˆ·åªèƒ½è¢«ç¦ç”¨ï¼Œä¸èƒ½è¢«åˆ é™¤
- âš ï¸ ä¿®æ”¹ç”¨æˆ·ç­‰çº§ä¼šç«‹å³å½±å“å…¶é…é¢é™åˆ¶
- âš ï¸ ç¦ç”¨ç”¨æˆ·åï¼Œå…¶ç°æœ‰çš„ API Key å°†å¤±æ•ˆ

---

### 2. æ¸ é“ç®¡ç† (`/admin/channels`)

**åŠŸèƒ½ï¼š**
- æ·»åŠ /ç¼–è¾‘/åˆ é™¤ä¸Šæ¸¸æ¸ é“ï¼ˆnew-api å®ä¾‹ï¼‰
- é…ç½®æ¸ é“æ”¯æŒçš„æ¨¡å‹åˆ—è¡¨
- å¯ç”¨/ç¦ç”¨æ¸ é“

**API æ¥å£ï¼š**
- `GET /admin/channels` - è·å–æ¸ é“åˆ—è¡¨
- `POST /admin/channels` - åˆ›å»ºæ¸ é“
- `PUT /admin/channels/:id` - æ›´æ–°æ¸ é“
- `DELETE /admin/channels/:id` - åˆ é™¤æ¸ é“

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
# åˆ›å»ºæ¸ é“
curl -X POST \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "OpenAI Official",
    "base_url": "https://api.openai.com",
    "api_key": "sk-xxx",
    "models": "[\"gpt-4\", \"gpt-3.5-turbo\"]",
    "status": "enabled"
  }' \
  http://localhost:8080/admin/channels
```

**å­—æ®µè¯´æ˜ï¼š**
- `name`: æ¸ é“åç§°ï¼ˆç”¨äºæ ‡è¯†ï¼‰
- `base_url`: new-api å®ä¾‹çš„ URL
- `api_key`: ä¸Šæ¸¸ API Key
- `models`: JSON æ•°ç»„æ ¼å¼çš„æ¨¡å‹åˆ—è¡¨
- `status`: `enabled` æˆ– `disabled`

**æ¨¡å‹å”¯ä¸€æ€§çº¦æŸï¼š**
- âœ… æ¯ä¸ªæ¨¡å‹ååªèƒ½å±äºä¸€ä¸ªæ¸ é“
- âœ… åˆ›å»º/æ›´æ–°æ¸ é“æ—¶ä¼šè‡ªåŠ¨æ£€æŸ¥å†²çª
- âŒ å¦‚æœæ¨¡å‹å·²å­˜åœ¨äºå…¶ä»–æ¸ é“ï¼Œæ“ä½œä¼šè¢«æ‹’ç»

**é”™è¯¯ç¤ºä¾‹ï¼š**
```json
{
  "error": "model 'gpt-4' already exists in channel 'OpenAI Official'"
}
```

---

### 3. é…é¢è§„åˆ™ç®¡ç† (`/admin/quota_rules`)

**åŠŸèƒ½ï¼š**
- åŸºäºç”¨æˆ·ç­‰çº§å’Œæ¨¡å‹å‰ç¼€è®¾ç½®è¯·æ±‚é™é¢
- é…ç½®æ—¶é—´çª—å£å’Œæœ€å¤§è¯·æ±‚æ¬¡æ•°

**API æ¥å£ï¼š**
- `GET /admin/quota_rules` - è·å–è§„åˆ™åˆ—è¡¨
- `POST /admin/quota_rules` - åˆ›å»ºè§„åˆ™
- `PUT /admin/quota_rules/:id` - æ›´æ–°è§„åˆ™
- `DELETE /admin/quota_rules/:id` - åˆ é™¤è§„åˆ™

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
# åˆ›å»ºé…é¢è§„åˆ™
curl -X POST \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "level": 1,
    "model_pattern": "gpt-4",
    "max_requests": 20,
    "window_seconds": 3600
  }' \
  http://localhost:8080/admin/quota_rules
```

**å­—æ®µè¯´æ˜ï¼š**
- `level`: ç”¨æˆ·ç­‰çº§
- `model_pattern`: æ¨¡å‹å‰ç¼€ï¼ˆæ”¯æŒå‰ç¼€åŒ¹é…ï¼‰
- `max_requests`: æ—¶é—´çª—å£å†…æœ€å¤§è¯·æ±‚æ¬¡æ•°
- `window_seconds`: æ—¶é—´çª—å£é•¿åº¦ï¼ˆç§’ï¼‰

**åŒ¹é…è§„åˆ™ï¼š**
- ä½¿ç”¨æœ€é•¿å‰ç¼€åŒ¹é…
- ä¾‹å¦‚ï¼š`gpt-4` ä¼šåŒ¹é… `gpt-4`, `gpt-4-turbo` ç­‰
- ç©ºå­—ç¬¦ä¸² `""` åŒ¹é…æ‰€æœ‰æ¨¡å‹ï¼ˆå…¨å±€é™åˆ¶ï¼‰

**ç¤ºä¾‹é…ç½®ï¼š**
```json
[
  {"level": 1, "model_pattern": "gpt-4", "max_requests": 10, "window_seconds": 3600},
  {"level": 1, "model_pattern": "gpt-3.5", "max_requests": 50, "window_seconds": 3600},
  {"level": 2, "model_pattern": "gpt-4", "max_requests": 50, "window_seconds": 3600},
  {"level": 2, "model_pattern": "", "max_requests": 200, "window_seconds": 86400}
]
```

---

## å‰ç«¯ç•Œé¢ä½¿ç”¨

### è®¿é—®ç®¡ç†åå°

1. ä½¿ç”¨ LinuxDo è´¦å·ç™»å½•
2. ç¡®ä¿è´¦å·å…·æœ‰ç®¡ç†å‘˜æƒé™ï¼ˆé¦–ä¸ªæ³¨å†Œç”¨æˆ·è‡ªåŠ¨æˆä¸ºç®¡ç†å‘˜ï¼‰
3. å¯¼èˆªæ ä¼šæ˜¾ç¤ºç®¡ç†åŠŸèƒ½å…¥å£

### ç”¨æˆ·ç®¡ç†ç•Œé¢

**è·¯å¾„ï¼š** `/admin/users`

**æ“ä½œæ­¥éª¤ï¼š**
1. ç‚¹å‡»ç”¨æˆ·åˆ—è¡¨ä¸­çš„"ç¼–è¾‘"æŒ‰é’®
2. åœ¨å¼¹çª—ä¸­ä¿®æ”¹è§’è‰²ã€ç­‰çº§æˆ–çŠ¶æ€
3. ç‚¹å‡»"ä¿å­˜"æäº¤æ›´æ”¹

**ç•Œé¢åŠŸèƒ½ï¼š**
- ğŸ“Š æ˜¾ç¤ºç”¨æˆ· IDã€ç”¨æˆ·åã€è§’è‰²ã€ç­‰çº§ã€çŠ¶æ€ã€æ³¨å†Œæ—¶é—´
- ğŸ·ï¸ è§’è‰²å’ŒçŠ¶æ€ä½¿ç”¨å½©è‰²æ ‡ç­¾æ˜¾ç¤º
- âœï¸ ç‚¹å‡»ç¼–è¾‘æŒ‰é’®æ‰“å¼€ç¼–è¾‘è¡¨å•

### æ¸ é“ç®¡ç†ç•Œé¢

**è·¯å¾„ï¼š** `/admin/channels`

**æ“ä½œæ­¥éª¤ï¼š**
1. ç‚¹å‡»"æ–°å»ºæ¸ é“"æŒ‰é’®
2. å¡«å†™æ¸ é“ä¿¡æ¯ï¼š
   - åç§°ï¼šä¾‹å¦‚ "OpenAI Official"
   - Base URLï¼šä¾‹å¦‚ "https://api.openai.com"
   - API Keyï¼šä¸Šæ¸¸å¯†é’¥
   - æ¨¡å‹åˆ—è¡¨ï¼šJSON æ•°ç»„ï¼Œä¾‹å¦‚ `["gpt-4", "gpt-3.5-turbo"]`
   - çŠ¶æ€ï¼šå¯ç”¨/ç¦ç”¨
3. ç‚¹å‡»"ä¿å­˜"

**æ³¨æ„äº‹é¡¹ï¼š**
- âš ï¸ æ¨¡å‹åˆ—è¡¨å¿…é¡»æ˜¯æœ‰æ•ˆçš„ JSON æ•°ç»„æ ¼å¼
- âš ï¸ å¦‚æœæ¨¡å‹å·²å­˜åœ¨äºå…¶ä»–æ¸ é“ï¼Œä¼šæç¤ºé”™è¯¯
- âœ… å¯ä»¥éšæ—¶å¯ç”¨/ç¦ç”¨æ¸ é“

---

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•ç¦ç”¨æŸä¸ªç”¨æˆ·ï¼Ÿ
A: åœ¨ç”¨æˆ·ç®¡ç†é¡µé¢ï¼Œç¼–è¾‘ç”¨æˆ·ï¼Œå°†çŠ¶æ€æ”¹ä¸º"å·²ç¦ç”¨"ã€‚

### Q: ç¦ç”¨ç”¨æˆ·åä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ
A: ç”¨æˆ·çš„ JWT å’Œ API Key éƒ½å°†å¤±æ•ˆï¼Œæ— æ³•è°ƒç”¨ APIã€‚

### Q: å¦‚ä½•ä¸ºä¸åŒç­‰çº§ç”¨æˆ·è®¾ç½®ä¸åŒé…é¢ï¼Ÿ
A: åœ¨é…é¢è§„åˆ™ç®¡ç†ä¸­ï¼Œä¸ºä¸åŒ level åˆ›å»ºä¸åŒçš„è§„åˆ™ã€‚

### Q: ä¸€ä¸ªæ¨¡å‹å¯ä»¥é…ç½®å¤šä¸ªæ¸ é“å—ï¼Ÿ
A: ä¸å¯ä»¥ã€‚æ¯ä¸ªæ¨¡å‹åªèƒ½å±äºä¸€ä¸ªæ¸ é“ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…è·¯ç”±å†²çªã€‚

### Q: å¦‚ä½•æµ‹è¯•æ¸ é“é…ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ
A: å¯ä»¥ä½¿ç”¨ curl å‘é€æµ‹è¯•è¯·æ±‚ï¼š
```bash
curl -X POST http://localhost:8080/v1/chat/completions \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{"model":"gpt-4","messages":[{"role":"user","content":"test"}]}'
```

---

## å®‰å…¨å»ºè®®

1. âœ… å®šæœŸå®¡æŸ¥ç”¨æˆ·åˆ—è¡¨ï¼Œç¦ç”¨ä¸æ´»è·ƒè´¦æˆ·
2. âœ… è°¨æ…æˆäºˆç®¡ç†å‘˜æƒé™
3. âœ… å®šæœŸæ›´æ¢ä¸Šæ¸¸ API Key
4. âœ… ç›‘æ§é…é¢ä½¿ç”¨æƒ…å†µï¼Œé˜²æ­¢æ»¥ç”¨
5. âœ… ä½¿ç”¨ HTTPS éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒ

